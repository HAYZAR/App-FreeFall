<script>
document.addEventListener("DOMContentLoaded", function() {
  // Generar opciones de velocidad inicial
  function generaOpcionesVelocidad(id) {
    const select = document.getElementById(id);
    select.innerHTML = '';
    for(let v = -30; v <= 30; v += 5){
      let txt = (v>0?'+':'') + v + ' m/s';
      select.innerHTML += `<option value="${v}">${txt}</option>`;
    }
  }
  generaOpcionesVelocidad('velocidad_inicial');
  generaOpcionesVelocidad('velocidad_inicial2');
  // Opciones de desplazamiento
  const selDespl = document.getElementById('desplazamiento');
  for(let x = 0; x <= 100; x += 5){
    selDespl.innerHTML += `<option value="${x}">${x} m</option>`;
  }
  // Cambio de modo de cálculo
  document.getElementById('calculo').addEventListener('change', function(){
    if(this.value === 'desplazamiento'){
      document.getElementById('campos-desplazamiento').style.display = '';
      document.getElementById('campos-velocidad').style.display = 'none';
    } else {
      document.getElementById('campos-desplazamiento').style.display = 'none';
      document.getElementById('campos-velocidad').style.display = '';
    }
    mostrarResultado();
  });
  // Cálculo y visualización automática
  function mostrarResultado(){
    const modo = document.getElementById('calculo').value;
    let resTxt = "";
    if(modo === 'desplazamiento'){
      const v0 = parseFloat(document.getElementById('velocidad_inicial').value);
      const t = parseFloat(document.getElementById('tiempo').value);
      const a = parseFloat(document.getElementById('aceleracion').value);
      const dx = v0 * t + 0.5 * a * t * t;
      resTxt = `Desplazamiento: <b>${dx.toFixed(2)} m</b>`;
    } else {
      const v0 = parseFloat(document.getElementById('velocidad_inicial2').value);
      const t = parseFloat(document.getElementById('tiempo2').value);
      const a = parseFloat(document.getElementById('aceleracion2').value);
      const dx = parseFloat(document.getElementById('desplazamiento').value);
      // Si el tiempo es cero, la velocidad es la inicial
      let v = v0 + a * t;
      resTxt = `Velocidad final: <b>${v.toFixed(2)} m/s</b>`;
    }
    const div = document.getElementById('resultado');
    div.innerHTML = resTxt;
    div.style.display = "block";
  }
  // Actualizar resultado al cambiar cualquier campo
  [
    'tiempo','velocidad_inicial','aceleracion',
    'desplazamiento','tiempo2','velocidad_inicial2','aceleracion2','calculo'
  ].forEach(id=>{
    document.getElementById(id).addEventListener('input', mostrarResultado);
    document.getElementById(id).addEventListener('change', mostrarResultado);
  });
  // Mostrar el resultado al cargar la página
  mostrarResultado();
  // Envío de formulario
  document.getElementById('freeFallForm').onsubmit = function(e){
    e.preventDefault();
    const modo = document.getElementById('calculo').value;
    let resultado;
    if(modo === 'desplazamiento'){
      const v0 = parseFloat(document.getElementById('velocidad_inicial').value);
      const t = parseFloat(document.getElementById('tiempo').value);
      const a = parseFloat(document.getElementById('aceleracion').value);
      resultado = v0 * t + 0.5 * a * t * t;
    } else {
      const v0 = parseFloat(document.getElementById('velocidad_inicial2').value);
      const t = parseFloat(document.getElementById('tiempo2').value);
      const a = parseFloat(document.getElementById('aceleracion2').value);
      resultado = v0 + a * t;
    }
    const datos = {
      nombre: this.nombre.value,
      calculo: modo,
      tiempo: this.tiempo ? this.tiempo.value : this.tiempo2.value,
      velocidad_inicial: this.velocidad_inicial ? this.velocidad_inicial.value : this.velocidad_inicial2.value,
      aceleracion: this.aceleracion ? this.aceleracion.value : this.aceleracion2.value,
      desplazamiento: this.desplazamiento ? this.desplazamiento.value : '',
      resultado: resultado
    };
    fetch('https://script.google.com/macros/s/AKfycbyvjZ9v5y0dBMNkFJbMPcvMTl4QTZa3PT6jtmBLgRbELV56ytWA_RAfcDW-6kH1oA3sIg/exec', { // ← Pega aquí tu URL de Apps Script
      method: 'POST',
      body: JSON.stringify(datos),
      headers: { 'Content-Type': 'application/json' }
    })
    .then(r => r.text())
    .then(txt => {
      document.getElementById('respuesta').innerHTML = 
        txt == 'OK' ? "¡Enviado correctamente! ✅" : "Error al enviar: " + txt;
      if (txt == 'OK') this.reset();
    }.bind(this));
  };
});
</script>
